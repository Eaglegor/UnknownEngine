<scene>

	<constant name="global_log_level" value="info"/>

	<subsystems>
		<subsystem name="Logger" module="ConsoleLogger">
			
			<messaging_rules>
				<listener>
					<message type="Utils.LogMessage">
						<receive_policy type="Any"/>
					</message>
				</listener>
			</messaging_rules>

		</subsystem>
		
		<subsystem name="WindowManager" module="SDLWindowManagerPlugin">
			
			<messaging_rules>
				
				<listener>
					<message type="Engine.MainLoop.UpdateFrameMessage"/>
					<message type="Graphics.GUI.GetWindowHandleMessage"/>
				</listener>
				
				<sender>
					<message type="IO.KeyStateChanged"/>
					<message type="IO.MouseMoved"/>
					<message type="IO.MouseWheelMoved"/>
					<message type="IO.MouseButtonStateChanged"/>
					<message type="Engine.MainLoop.UpdateFrameMessage"/>
					<message type="Utils.LogMessage"/>
				</sender>
				
			</messaging_rules>

			<options_section>
				<options_section name="RenderWindow">
					<option name="width" value="800"/>
					<option name="height" value="600"/>
					<option name="window_name" value="TestWindow"/>
					<option name="window_title" value="Test render window"/>
					<option name="fullscreen" value="false"/>
					<option name="resizable" value="false"/>
				</options_section>
			</options_section>
			
		</subsystem>
		
		<subsystem name="Graphics" module="OgreRenderSystem">
		
			<dependencies>
				<dependency>UserInput</dependency>
			</dependencies>
		
			<messaging_rules>
				
				<listener>
					<message type="Engine.MainLoop.UpdateFrameMessage">
						<receive_policy type="FromSingleSender">
							<options_section>
								<option name="sender_name" value="Engine"/>
							</options_section>
						</receive_policy>
					</message>
				</listener>
			
				<sender>
					<message type="Graphics.GUI.GetWindowHandleMessage"/>
					<message type="Utils.LogMessage"/>
				</sender>
				
			</messaging_rules>
		
			<options_section>
				
				<option name="log_level" value="${global_log_level}"/>

				<option name="separate_rendering_thread" value="true"/>
				
				<options_section name="RenderWindow">

					<option name="window_name" value="TestWindow"/>
					<option name="window_title" value="ParserTestWindowTitle"/>
					<option name="window_type" value="external"/>
					
					<option name="width" value="1024"/>
					<option name="height" value="768"/>
					
					<options_section name="window_flags">
						<option name="fullscreen" value="false"/>
					</options_section>
					
				</options_section>
				
				<options_section name="ConfigFiles">
					<option name="ogre_plugins_filename" value="plugins.cfg"/>
					<option name="ogre_log_filename" value="Ogre.log"/>
					<option name="ogre_config_filename" value="ogre.cfg"/>
					<option name="ogre_resources_filename" value="resources.cfg"/>
				</options_section>
				
			</options_section>
			
		</subsystem>
		
		<subsystem name="MeshDataLoader" module="AssimpMeshDataLoader"/>
		
		<subsystem name="InputContext" module="InputContextMapper">
			
			<options_section>
				<option name="log_level" value="${global_log_level}"/>
				<option name="action_slots_config_file" value="InputContextMapperConfig/ActionSlots.xml"/>
				<option name="input_layout_config_file" value="InputContextMapperConfig/InputLayout.cfg"/>
			</options_section>
			
			<messaging_rules>
				
				<listener>
					<message type="Engine.MainLoop.UpdateFrameMessage"/>
					<message type="IO.KeyStateChanged"/>
					<message type="IO.MouseMoved"/>
					<message type="IO.MouseWheelMoved"/>
					<message type="IO.MouseButtonStateChanged"/>
					<message type="IO.InputContext.AddSimpleActionMessage"/>
					<message type="IO.InputContext.AddRangeActionMessage"/>
				</listener>
				
				<sender>
					<message type="Utils.LogMessage"/>
				</sender>
				
			</messaging_rules>
		</subsystem>
		
		<subsystem name="SimpleBehavior" module="SimpleBehaviorPlugin">
			
			<messaging_rules>
				<listener>
					<message type="Engine.MainLoop.UpdateFrameMessage"/>
				</listener>
				
				<sender>
					<message type="Engine.StopEngineActionMessage"/>
					<message type="IO.InputContext.AddSimpleActionMessage"/>
					<message type="Utils.LogMessage"/>
				</sender>
			</messaging_rules>
			
		</subsystem>
		
		<subsystem name="Physics" module="PhysXPlugin">
			<messaging_rules>
				<listener>
					<message type="Engine.MainLoop.UpdateFrameMessage"/>
				</listener>
				<sender>
					<message type="Utils.LogMessage"/>
				</sender>
			</messaging_rules>
			
			<options_section>
				<option name="gravity" value="Vector3(x:0, y:-9.8, z:0)"/>
				<option name="log_level" value="${global_log_level}"/>
				<option name="enable_profiling" value="false"/>
				<option name="enable_hardware" value="false"/>
			</options_section>
		</subsystem>
		
		<subsystem name="ScriptEngine" module="AngelScriptPlugin">
			<options_section>
				<option name="log_level" value="debug"/>
			</options_section>
		</subsystem>
		
	</subsystems>

	<entities>

		<entity name="MasterScript">
			<component name="Script" type="Behavior.AngelScript">
				
				<messaging_rules>
					<listener>
						<message type="Engine.MainLoop.UpdateFrameMessage"/>
					</listener>
					<sender>
						<message type="Engine.StopEngineActionMessage"/>
						<message type="Utils.LogMessage"/>
					</sender>
				</messaging_rules>
				
				<options_section>
					<option name="script_filename" value="test.as"/>
				</options_section>
			</component>
		</entity>
	
		<entity name="Lighting">
			
			<component name="LightComponentD" type="Graphics.Light.Directional">
			
				<options_section>
					
					<options_section name="InitialTransform">
						<option name="initial_direction" value="Vector3(x:0, y:-50, z:-50)"/>
					</options_section>
					
					<option name="log_level" value="${global_log_level}"/>
					
					<options_section name="LightSettings">
						<option name="intensity" value="1"/>
						<option name="diffuse_color" value="Colour(r:1, g:1, b:1)"/>
						<option name="specular_color" value="Colour(r:1, g:1, b:1)"/>
					</options_section>

				</options_section>
			</component>

		</entity>
	
		<entity name="MainCamera">
		
			<component name="Rotation" type="Behavior.MouseLook">
				
				<messaging_rules>
					<sender>
						<message type="Engine.TransformChangedMessage"/>
						<message type="IO.InputContext.AddSimpleActionMessage"/>
						<message type="IO.InputContext.AddRangeActionMessage"/>
					</sender>
				</messaging_rules>
				
				<options_section>
					<option name="input_context_name" value="MouseLook"/>
					<options_section name="InitialTransform">
						<option name="position" value="Vector3(x:0, y:10, z:50)"/>
					</options_section>
				</options_section>
			</component>
			
			<component type="Graphics.Camera" name="Camera">
				
				<messaging_rules><listener>
					<message type="Engine.TransformChangedMessage">
						<receive_policy type="FromSingleSender">
							<options_section>
								<option name="sender_name" value="MainCamera.Rotation"/>
							</options_section>
						</receive_policy>
					</message>
				</listener></messaging_rules>
				
				<options_section>
					
					<option name="render_window_name" value="TestWindow"/>
					<option name="log_level" value="${global_log_level}"/>
					<option name="far_clip_distance" value="100"/>
					<option name="near_clip_distance" value="0.01"/>
					
					<options_section name="InitialTransform">
						<option name="position" value="Vector3(x:0, y:10, z:50)"/>
						<option name="initial_direction" value="Vector3(x:0, y:0, z:-50)"/>
					</options_section>
					
				</options_section>
					
			</component>
						
			<component name="LightComponentS" type="Graphics.Light.Spot">

				<messaging_rules><listener>
					<message type="Engine.TransformChangedMessage">
						<receive_policy type="FromSingleSender">
							<options_section>
								<option name="sender_name" value="MainCamera.Rotation"/>
							</options_section>
						</receive_policy>
					</message>
				</listener></messaging_rules>
			
				<options_section>
					
					<options_section name="InitialTransform">
						<option name="initial_direction" value="Vector3(x:0, y:0, z:-50)"/>
					</options_section>
					
					<option name="log_level" value="${global_log_level}"/>
					
					<options_section name="LightSettings">
						<option name="intensity" value="1"/>
						<option name="diffuse_color" value="Colour(r:1, g:1, b:1)"/>
						<option name="specular_color" value="Colour(r:1, g:1, b:1)"/>
						<option name="spotlight_inner_angle" value="5"/>
						<option name="spotlight_outer_angle" value="20"/>
					</options_section>

				</options_section>
			</component>
						
		</entity>

		<data_provider name="CubeMesh" type="Loader.MeshData.AssimpMeshDataLoader">
			<options_section>
				<option name="filename" value="media/models/Cube.obj"/>
				<option name="log_level" value="${global_log_level}"/>
				
				<options_section name="Postprocessing">
					<option name="generate_tangents" value="true"/>
					<option name="generate_normals" value="true"/>
					<option name="triangulate" value="true"/>
				</options_section>
				
			</options_section>
		</data_provider>
			
		<data_provider name="FloorMesh" type="Loader.MeshData.AssimpMeshDataLoader">
			<options_section>
				<option name="filename" value="media/models/Floor.obj"/>
				<option name="log_level" value="${global_log_level}"/>
				
				<options_section name="Postprocessing">
					<option name="generate_tangents" value="true"/>
					<option name="generate_normals" value="true"/>
					<option name="triangulate" value="true"/>
				</options_section>
				
			</options_section>
		</data_provider>
		
		<data_provider name="HalfSphereMesh" type="Loader.MeshData.AssimpMeshDataLoader">
			<options_section>
				<option name="filename" value="media/models/HalfSphere.obj"/>
				<option name="log_level" value="${global_log_level}"/>
				
				<options_section name="Postprocessing">
					<option name="generate_tangents" value="true"/>
					<option name="generate_normals" value="true"/>
					<option name="triangulate" value="true"/>
				</options_section>
				
			</options_section>
		</data_provider>

		<data_provider name="OgreCubeMesh" type="Loader.OgreMeshPtr.OgreMeshPtrFromMeshDataProvider">
			<options_section>
				<provided_data name="mesh_data_provider" data_provider_name="CubeMesh"/>
				<option name="log_level" value="${global_log_level}"/>
			</options_section>
		</data_provider>
		
		<data_provider name="OgreFloorMesh" type="Loader.OgreMeshPtr.OgreMeshPtrFromMeshDataProvider">
			<options_section>
				<provided_data name="mesh_data_provider" data_provider_name="FloorMesh"/>
				<option name="log_level" value="${global_log_level}"/>
			</options_section>
		</data_provider>
		
		<data_provider name="OgreHalfSphereMesh" type="Loader.OgreMeshPtr.OgreMeshPtrFromMeshDataProvider">
			<options_section>
				<provided_data name="mesh_data_provider" data_provider_name="HalfSphereMesh"/>
				<option name="log_level" value="${global_log_level}"/>
			</options_section>
		</data_provider>
		
		<data_provider name="DefaultPhysicsMaterial" type="Loader.PxMaterial.PxMaterialDataProvider">
			<options_section>
				<option name="static_friction" value="1"/>
				<option name="dynamic_friction" value="1"/>
				<option name="restitution" value="0.1"/>
			</options_section>
		</data_provider>
		
		<data_provider name="CubeShape" type="Loader.PxShape.PxBoxShapeDataProvider">
			<options_section>
				<provided_data name="material" data_provider_name="DefaultPhysicsMaterial"/>
				<option name="width" value="1"/>
				<option name="height" value="1"/>
				<option name="depth" value="1"/>
			</options_section>
		</data_provider>
		
		<data_provider name="FloorShape" type="Loader.PxShape.PxBoxShapeDataProvider">
			<options_section>
				<provided_data name="material" data_provider_name="DefaultPhysicsMaterial"/>
				<option name="width" value="50"/>
				<option name="height" value="0.5"/>
				<option name="depth" value="50"/>
			</options_section>
		</data_provider>
		
		
		<entity name="Floor">
			
			<component name="Graphics" type="Graphics.Renderable">
				<options_section>
					
					<option name="log_level" value="${global_log_level}"/>
					<option name="throw_exception_on_missing_mesh_data" value="true"/>
					
					<provided_data name="mesh_ptr_provider" data_provider_name="OgreFloorMesh"/>
					
					<options_section name="Material">
						<option name="material_name" value="FloorMaterial"/>
					</options_section>
					
				</options_section>
			</component>
			
			<component name="RigidBodyComponent" type="Physics.RigidBody">
				<options_section>
					<provided_data name="shape" data_provider_name="FloorShape"/>
					<option name="dynamics_type" value="static"/>
					<option name="mass" value="1"/>
				</options_section>
			</component>
						
		</entity>
		
		<entity name="ActiveCube">
			
			<component name="AxisMovement" type="Behavior.MouseLook">
				
				<messaging_rules>
					<sender>
						<message type="IO.InputContext.AddSimpleActionMessage"/>
						<message type="Engine.TransformChangedMessage"/>
					</sender>
				</messaging_rules>
				
				<options_section>
					<option name="input_context_name" value="CubeControl"/>
					<options_section name="InitialTransform">
						<option name="position" value="Vector3(x:10, y:10, z:0)"/>
					</options_section>
				</options_section>
			</component>
			
			<component name="RigidBodyComponent" type="Physics.RigidBody">
				
				<messaging_rules>
					<listener>
						<message type="Engine.TransformChangedMessage">
							<receive_policy type="FromSingleSender">
								<options_section>
									<option name="sender_name" value="ActiveCube.AxisMovement"/>
								</options_section>
							</receive_policy>
						</message>
					</listener>
					<sender>
						<message type="Engine.TransformChangedMessage"/>
					</sender>
				</messaging_rules>
				
				<options_section>
					<provided_data name="shape" data_provider_name="CubeShape"/>
					<option name="dynamics_type" value="kinematic"/>
					<option name="mass" value="1"/>
					
					<options_section name="InitialTransform">
						<option name="position" value="Vector3(x:10, y:10, z:0)"/>
					</options_section>
					
				</options_section>
			</component>
			
			<component name="Graphics" type="Graphics.Renderable">
				
				<messaging_rules><listener>
					<message type="Engine.TransformChangedMessage">
						<receive_policy type="FromSingleSender">
							<options_section>
								<option name="sender_name" value="ActiveCube.RigidBodyComponent"/>
							</options_section>
						</receive_policy>
					</message>
				</listener></messaging_rules>
				
				<options_section>
					
					<option name="log_level" value="${global_log_level}"/>
					<option name="throw_exception_on_missing_mesh_data" value="true"/>
					
					<provided_data name="mesh_ptr_provider" data_provider_name="OgreCubeMesh"/>
					
					<options_section name="Material">
						<option name="material_name" value="ActiveCubeMaterial"/>
					</options_section>
					
					<options_section name="InitialTransform">
						<option name="position" value="Vector3(x:10, y:10, z:0)"/>
					</options_section>
					
				</options_section>
			</component>
			
			<component name="JointComponent" type="Behavior.SimpleCreateJoint">
				
				<messaging_rules>
					<sender>
						<message type="IO.InputContext.AddSimpleActionMessage"/>
						<message type="Graphics.ChangeMaterialActionMessage"/>
					</sender>
				</messaging_rules>
				
				<options_section>
					<option name="body1_name" value="ActiveCube.RigidBodyComponent"/>
					<option name="body2_name" value="PassiveCube.RigidBodyComponent"/>
					<option name="input_context_name" value="TestCreateJoint"/>
					<option name="jointed_material_name" value="ActiveCubeMaterial"/>
					<option name="free_material_name" value="NormalMap"/>
				</options_section>
			</component>
						
		</entity>
		
		<entity name="PassiveCube">
			
			<component name="RigidBodyComponent" type="Physics.RigidBody">
				
				<messaging_rules>
					<sender>
						<message type="Engine.TransformChangedMessage"/>
					</sender>
				</messaging_rules>
				
				<options_section>
					<provided_data name="shape" data_provider_name="CubeShape"/>
					<option name="dynamics_type" value="dynamic"/>
					<option name="mass" value="10"/>
					
					<options_section name="InitialTransform">
						<option name="position" value="Vector3(x:-10, y:10, z:0)"/>
					</options_section>
					
				</options_section>
			</component>
			
			<component name="Graphics" type="Graphics.Renderable">
				
				<messaging_rules><listener>
					<message type="Engine.TransformChangedMessage">
						<receive_policy type="FromSingleSender">
							<options_section>
								<option name="sender_name" value="PassiveCube.RigidBodyComponent"/>
							</options_section>
						</receive_policy>
					</message>
					<message type="Graphics.ChangeMaterialActionMessage">
						<receive_policy type="FromSingleSender">
							<options_section>
								<option name="sender_name" value="ActiveCube.JointComponent"/>
							</options_section>
						</receive_policy>
					</message>
				</listener></messaging_rules>
				
				<options_section>
					
					<option name="log_level" value="${global_log_level}"/>
					<option name="throw_exception_on_missing_mesh_data" value="true"/>
					
					<provided_data name="mesh_ptr_provider" data_provider_name="OgreCubeMesh"/>
					
					<options_section name="Material">
						<option name="material_name" value="NormalMap"/>
					</options_section>
					
				</options_section>
			</component>
						
		</entity>
		
		<entity name="HalfSphere">
			
			<component name="Graphics" type="Graphics.Renderable">
				<options_section>
					
					<option name="log_level" value="${global_log_level}"/>
					<option name="throw_exception_on_missing_mesh_data" value="true"/>
					
					<provided_data name="mesh_ptr_provider" data_provider_name="OgreHalfSphereMesh"/>
					
					<options_section name="Material">
						<option name="material_name" value="FloorMaterial"/>
					</options_section>
					
				</options_section>
			</component>
						
		</entity>
		
	</entities>
	
</scene>
